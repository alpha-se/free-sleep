// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model sleep_records {
  id                    Int      @id @default(autoincrement())
  side                  String
  entered_bed_at        DateTime
  left_bed_at           DateTime
  sleep_period_seconds  Int
  times_exited_bed      Int
  present_intervals     String
  not_present_intervals String

  @@unique([side, entered_bed_at])
  // Create an index on 'side' and 'entered_bed_at'
  @@index([side, entered_bed_at])
}

model vitals {
  id             Int    @id @default(autoincrement())
  side           String
  period_start   Int // 5-minute interval start (Unix timestamp)
  heart_rate     Float? // Averaged over 5 minutes
  hrv            Float? // Averaged over 5 minutes
  breathing_rate Float? // Averaged over 5 minutes

  @@unique([side, period_start]) // Ensure no duplicate intervals
  @@index([side, period_start])
}

// # Create DB file
// npx prisma migrate dev --name init
// # regen prisma client
// npx prisma generate

// Updating
// npx prisma migrate dev --name add-notes-column
// regen prisma client
// npx prisma generate

// -----------------------------------------------------------------------------------------------------
// {'side': 'right', 'entered_bed_at': '2025-02-02T05:01:35', 'left_bed_at': '2025-02-02T14:06:39', 'sleep_period_seconds': 32554, 'times_exited_bed': 2, 'present_intervals': '[["2025-02-02T05:01:35", "2025-02-02T05:05:11"], ["2025-02-02T05:06:20", "2025-02-02T06:07:21"], ["2025-02-02T06:08:42", "2025-02-02T14:06:39"]]', 'not_present_intervals': '[["2025-02-02T05:05:11", "2025-02-02T05:06:20"], ["2025-02-02T06:07:21", "2025-02-02T06:08:42"]]'}
// -----------------------------------------------------------------------------------------------------
// {'side': 'right', 'entered_bed_at': '2025-02-03T06:27:09', 'left_bed_at': '2025-02-03T14:06:33', 'sleep_period_seconds': 27404, 'times_exited_bed': 1, 'present_intervals': '[["2025-02-03T06:27:09", "2025-02-03T06:53:27"], ["2025-02-03T06:56:07", "2025-02-03T14:06:33"]]', 'not_present_intervals': '[["2025-02-03T06:53:27", "2025-02-03T06:56:07"]]'}
// -----------------------------------------------------------------------------------------------------
// {'side': 'right', 'entered_bed_at': '2025-02-03T06:26:57', 'left_bed_at': '2025-02-03T14:05:44', 'sleep_period_seconds': 27275, 'times_exited_bed': 2, 'present_intervals': '[["2025-02-03T06:26:57", "2025-02-03T06:52:13"], ["2025-02-03T06:53:46", "2025-02-03T13:38:01"], ["2025-02-03T13:40:40", "2025-02-03T14:05:44"]]', 'not_present_intervals': '[["2025-02-03T06:52:13", "2025-02-03T06:53:14"], ["2025-02-03T06:53:22", "2025-02-03T06:53:46"], ["2025-02-03T13:38:01", "2025-02-03T13:40:40"]]'}
// -----------------------------------------------------------------------------------------------------
// {'side': 'left', 'entered_bed_at': '2025-02-03T04:11:06', 'left_bed_at': '2025-02-03T14:00:53', 'sleep_period_seconds': 34766, 'times_exited_bed': 12, 'present_intervals': '[["2025-02-03T04:11:06", "2025-02-03T04:52:44"], ["2025-02-03T04:55:08", "2025-02-03T05:33:11"], ["2025-02-03T05:34:24", "2025-02-03T07:07:45"], ["2025-02-03T07:09:28", "2025-02-03T07:58:25"], ["2025-02-03T07:58:40", "2025-02-03T08:00:40"], ["2025-02-03T08:01:12", "2025-02-03T08:03:27"], ["2025-02-03T08:03:37", "2025-02-03T08:12:05"], ["2025-02-03T08:12:12", "2025-02-03T08:16:49"], ["2025-02-03T08:17:07", "2025-02-03T08:33:11"], ["2025-02-03T08:33:57", "2025-02-03T11:42:26"], ["2025-02-03T11:44:52", "2025-02-03T13:03:55"], ["2025-02-03T13:04:11", "2025-02-03T13:32:29"], ["2025-02-03T13:32:40", "2025-02-03T14:00:53"]]', 'not_present_intervals': '[["2025-02-03T04:52:44", "2025-02-03T04:55:08"], ["2025-02-03T05:33:11", "2025-02-03T05:34:24"], ["2025-02-03T07:07:45", "2025-02-03T07:09:28"], ["2025-02-03T07:58:25", "2025-02-03T07:58:40"], ["2025-02-03T08:00:40", "2025-02-03T08:00:49"], ["2025-02-03T08:00:57", "2025-02-03T08:01:12"], ["2025-02-03T08:03:27", "2025-02-03T08:03:37"], ["2025-02-03T08:12:05", "2025-02-03T08:12:12"], ["2025-02-03T08:16:49", "2025-02-03T08:17:07"], ["2025-02-03T08:33:11", "2025-02-03T08:33:19"], ["2025-02-03T08:33:26", "2025-02-03T08:33:42"], ["2025-02-03T08:33:49", "2025-02-03T08:33:57"], ["2025-02-03T11:42:26", "2025-02-03T11:44:52"], ["2025-02-03T13:03:55", "2025-02-03T13:04:11"], ["2025-02-03T13:32:29", "2025-02-03T13:32:40"]]'}
// sudo ln -s /Users/ds/free-sleep/server/free-sleep-data /persistent/free-sleep-data
